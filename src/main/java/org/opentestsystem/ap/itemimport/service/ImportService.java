package org.opentestsystem.ap.itemimport.service;

import lombok.extern.slf4j.Slf4j;
import org.opentestsystem.ap.itemimport.config.AppProps;
import org.opentestsystem.ap.itemimport.config.ApplicationDependencyProvider;
import org.opentestsystem.ap.itemimport.handler.ItemImportHandler;
import org.opentestsystem.ap.itemimport.util.ItemFileUtil;
import org.springframework.stereotype.Component;

@Slf4j
@Component
public class ImportService {

    private final AppProps appProps;

    private final ImportServiceValidator importValidator;

    private final ItemImportHandler importHandler;

    public ImportService(final ApplicationDependencyProvider dependencyProvider,
                         final ImportServiceValidator importValidator,
                         final ItemImportHandler importHandler) {
        this.appProps = dependencyProvider.getAppProps();
        this.importValidator = importValidator;
        this.importHandler = importHandler;
    }

    /**
     * Main item import process
     */
    public void importItems() {
        if (appProps.isImportEnabled()) {

            ItemFileUtil.fileToCollection(this.appProps.getIncludeFile())
                        .forEach(this::importItem);

        } else {
            log.info("Item import is disabled");
        }
    }

    public void validateProps() {
        importValidator.validateProps(this.appProps);
    }

    private void importItem(String fileName) {
        importHandler.importItem(fileName);
    }

}