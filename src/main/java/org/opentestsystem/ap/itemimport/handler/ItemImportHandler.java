package org.opentestsystem.ap.itemimport.handler;

import lombok.extern.slf4j.Slf4j;
import org.opentestsystem.ap.itemimport.config.AppProps;
import org.opentestsystem.ap.itemimport.config.ApplicationDependencyProvider;
import org.opentestsystem.ap.itemimport.util.ItemFileUtil;
import org.springframework.stereotype.Component;

import java.io.File;

@Slf4j
@Component
public class ItemImportHandler {

    private final AppProps appProps;

    public ItemImportHandler(final ApplicationDependencyProvider dependencyProvider) {
        this.appProps = dependencyProvider.getAppProps();
    }

    public void importItem(String itemFileName) {
        final String itemZipFullPath = appProps.getSourceDir() + "/" + itemFileName;
        File f = new File(itemZipFullPath);
        if (f.exists()) {
            String expandZipLocation = ItemFileUtil.expandZipFile(itemZipFullPath, appProps.getLocalImportDir());

            File itemFile = ItemFileUtil
                    .findItemFileInPath(expandZipLocation, itemFileName.replace(".zip", ".xml"));

            if (itemFile != null) {
                // Load item XML into item JSON
            }

            log.info(itemFile.getName());
        }
    }

}
