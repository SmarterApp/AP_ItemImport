package org.opentestsystem.ap.itemimport.model.report;

import lombok.Data;
import lombok.NoArgsConstructor;
import org.opentestsystem.ap.common.saaif.mapper.model.ItemMappingResult;
import org.opentestsystem.ap.itemimport.config.ApplicationProps;

import java.time.Instant;
import java.util.ArrayList;
import java.util.Date;
import java.util.List;
import java.util.concurrent.TimeUnit;

@Data
@NoArgsConstructor
public class ImportReport {

    private Date reportDate = new Date();

    private long reportStart;

    private Date dateStart;

    private long reportEnd;

    private Date dateEnd;

    ApplicationProps applicationProps;

    public void startTimer() {
        dateStart = new Date();
        reportStart = Instant.now().toEpochMilli();
    }

    public void stopTimer() {
        dateEnd = new Date();
        reportEnd = Instant.now().toEpochMilli();
    }

    public List<ItemMappingResult> importResults = new ArrayList<>();

    public Integer successCount = 0;

    public Date getStartTime() { return dateStart; }

    public Date getEndTime() {
        return dateEnd;
    }

    public String getExecutionTime() {
        long diffMilliseconds = reportEnd - reportStart;
        return String.format("%d min, %d sec",
                TimeUnit.MILLISECONDS.toMinutes(diffMilliseconds),
                TimeUnit.MILLISECONDS.toSeconds(diffMilliseconds) -
                        TimeUnit.MINUTES.toSeconds(TimeUnit.MILLISECONDS.toMinutes(diffMilliseconds)));
    }
}
